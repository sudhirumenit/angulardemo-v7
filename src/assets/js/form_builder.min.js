$(function(){var a={el:null,method:"POST",action:"",delimeter:"=",setElement:function(a){this.el=a},getElement:function(){return this.el},cleanName:function(a){return void 0===a||0===a.length?"":a.trim().replace(/ /g,"_").replace(/\W/g,"").toLowerCase()},cleanContent:function(a){return a.replace(/\t/,"").replace(/ ui-draggable| element/gi,"").replace(/<div class="close">.<\/div>/g,"").replace(/ data-(.+)="(.+)"/g,"")},updateSource:function(){var a='<form method="'+this.method+'" '+'action="'+this.action+'" '+'class="form-horizontal">\n'+$("#content").html()+"\n</form>";source.setValue(this.cleanContent(a)),source.autoFormatRange({line:0,ch:0},{line:source.lastLine()+1,ch:0})},addComponent:function(a){a.clone().removeClass("component").addClass("element").removeAttr("id").prepend('<div class="close">&times;</div>').appendTo("#content"),$("#options_modal").modal("hide"),this.updateSource()},loadOptions:function(b){var c=$(this),d=$("#options_modal"),e=d.find(".modal-body");return b?$.get("options/"+b+".html",function(f){return void 0===f?!1:(d.data("type",b),e.html(f),a.setElement(c),a[b].get(),d.modal("show"),!0)}):!1},title:{prefix:".options_title_",get:function(){var b=a.getElement(),c=b.find("legend");$(this.prefix+"name").val(c.text()).focus()},set:function(){var b=a.getElement(),c=b.find("legend");c.text($(this.prefix+"name").val())}},text:{prefix:".options_text_",get:function(){var b=a.getElement();$(this.prefix+"name").val(""),$(this.prefix+"label").val(b.find("label").text()),$(this.prefix+"placeholder").val(b.find("input[type=text]").attr("placeholder"))},set:function(){var b=a.getElement(),c=b.find("input[type=text]"),d=b.find("label"),e=a.cleanName($(this.prefix+"name").val());c.attr("name",e),d.text($(this.prefix+"label").val()).attr("for",e),c.attr("placeholder",$(this.prefix+"placeholder").val()).attr("id",e)}},textarea:{prefix:".options_textarea_",get:function(){var b=a.getElement();$(this.prefix+"name").val(""),$(this.prefix+"label").val(b.find("label").text()),$(this.prefix+"placeholder").val(b.find("textarea").attr("placeholder"))},set:function(){var b=a.getElement(),c=b.find("textarea"),d=b.find("label");c.attr("name",a.cleanName($(this.prefix+"name").val())),d.text($(this.prefix+"label").val()),c.attr("placeholder",$(this.prefix+"placeholder").val())}},select_basic:{prefix:".options_select_basic_",get:function(){var b=a.getElement(),c="",d=a.delimeter;b.find("select > option").each(function(b,e){var f=a.cleanName($(e).text())==$(e).val()?"":$(e).val()+d;c+=f+$(e).text()+"\n"}),$(this.prefix+"name").val(""),$(this.prefix+"label").val(b.find("label").text()),$(this.prefix+"options").val(c)},set:function(){var b=a.getElement(),c=b.find("select"),d=b.find("label"),e=a.delimeter,f=$(this.prefix+"options").val(),g=f.replace(/\r\n/,"\n").split("\n"),h="\n";$.each(g,function(b,c){if(c.length>0)if(-1!==c.indexOf(e)){var d=c.split(e);h+='<option value="'+d[0]+'">'+d[1]+"</option>\n"}else h+='<option value="'+a.cleanName(c)+'">'+c+"</option>\n"}),c.attr("name",a.cleanName($(this.prefix+"name").val())),d.text($(this.prefix+"label").val()),c.html(h)}},select_multiple:{prefix:".options_select_multiple_",get:function(){var b=a.getElement(),c="",d=a.delimeter;b.find("select > option").each(function(b,e){var f=a.cleanName($(e).text())==$(e).val()?"":$(e).val()+d;c+=f+$(e).text()+"\n"}),$(this.prefix+"name").val(""),$(this.prefix+"label").val(b.find("label").text()),$(this.prefix+"options").val(c)},set:function(){var b=a.getElement(),c=b.find("select"),d=b.find("label"),e=a.delimeter,f=$(this.prefix+"options").val(),g=f.replace(/\r\n/,"\n").split("\n"),h="\n";$.each(g,function(b,c){if(c.length>0)if(-1!==c.indexOf(e)){var d=c.split(e);h+='<option value="'+d[0]+'">'+d[1]+"</option>\n"}else h+='<option value="'+a.cleanName(c)+'">'+c+"</option>\n"}),c.attr("name",a.cleanName($(this.prefix+"name").val())+"[]"),d.text($(this.prefix+"label").val()),c.html(h)}},checkbox:{prefix:".options_checkbox_",get:function(){var b=a.getElement(),c="",d=a.delimeter;b.find("input[type=checkbox]").each(function(){var e=$(this).val().length>0&&"on"!==$(this).val()?$(this).val()+d:"";c+=e+$(this).closest("label").text().trim()+"\n"}),$(this.prefix+"name").val(""),$(this.prefix+"label").val(b.find("label:first").text()),$(this.prefix+"options").val(c)},set:function(){var b=a.getElement(),c=b.find("label:first"),d=a.delimeter,e=$(this.prefix+"options").val(),f=e.replace(/\r\n/,"\n").split("\n"),g=a.cleanName($(this.prefix+"name").val()),h="\n";$.each(f,function(b,c){var e=g+"_"+b;if(c.length>0)if(-1!==c.indexOf(d)){var f=c.split(d);h+='<div class="checkbox"><label for="'+e+'">\n'+'<input type="checkbox" name="'+g+'" '+'id="'+e+'" '+'value="'+f[0]+'">\n'+f[1]+"\n"+"</label></div>\n"}else h+='<div class="checkbox"><label for="'+e+'">\n'+'<input type="checkbox" name="'+g+'" '+'id="'+e+'" '+'value="'+a.cleanName(c)+'">\n'+c+"\n"+"</label></div>\n"}),c.text($(this.prefix+"label").val()),b.find(".controls").html(h)}},radio:{prefix:".options_radio_",get:function(){var b=a.getElement(),c="",d=a.delimeter;b.find("input[type=radio]").each(function(){var e=$(this).val().length>0&&"on"!==$(this).val()?$(this).val()+d:"";c+=e+$(this).closest("label").text().trim()+"\n"}),$(this.prefix+"name").val(""),$(this.prefix+"label").val(b.find("label:first").text()),$(this.prefix+"options").val(c)},set:function(){var b=a.getElement(),c=b.find("label:first"),d=a.delimeter,e=$(this.prefix+"options").val(),f=e.replace(/\r\n/,"\n").split("\n"),g=a.cleanName($(this.prefix+"name").val()),h="\n";$.each(f,function(b,c){var e=g+"_"+b;if(c.length>0)if(-1!==c.indexOf(d)){var f=c.split(d);h+='<div class="radio"><label for="'+e+'">\n'+'<input type="radio" name="'+g+'" '+'id="'+e+'" '+'value="'+f[0]+'">\n'+f[1]+"\n"+"</label></div>\n"}else h+='<div class="radio"><label for="'+e+'">\n'+'<input type="radio" name="'+g+'" '+'id="'+e+'" '+'value="'+a.cleanName(c)+'">\n'+c+"\n"+"</label></div>\n"}),c.text($(this.prefix+"label").val()),b.find(".controls").html(h)}},static_text:{prefix:".options_static_text_",get:function(){var b=a.getElement();$(this.prefix+"label").val(b.find("label").text()),$(this.prefix+"text").val(b.find(".controls").html().trim())},set:function(){var b=a.getElement();b.find("label").text($(this.prefix+"label").val()),b.find(".controls").html($(this.prefix+"text").val())}},submit:{prefix:".options_submit_",get:function(){var b=a.getElement();$(this.prefix+"label").val(b.find("button[type=submit]").text()),b.find("button[type=button]").hasClass("hide")?$(this.prefix+"show_cancel").val(0):$(this.prefix+"show_cancel").val(1),$(this.prefix+"method").val(a.method),$(this.prefix+"action").val(a.action)},set:function(){var b=a.getElement(),c=b.find("button[type=button]");b.find("button[type=submit]").text($(this.prefix+"label").val()),1==$(this.prefix+"show_cancel").val()?c.hasClass("hide")&&c.removeClass("hide"):c.hasClass("hide")||c.addClass("hide"),a.method=$(this.prefix+"method").val(),a.action=$(this.prefix+"action").val()}}};$(".component").draggable({helper:function(){return $(this).clone().addClass("component-drag")}}).on("click",function(){a.addComponent($(this))}),$(document).on("click",".element > .close",function(a){a.stopPropagation(),$(this).parent().fadeOut("normal",function(){$(this).remove()})}),$(document).on("click",".element",function(){a.loadOptions.call(this,$(this).data("type"))}),$("#save_options").on("click",function(){var b=$("#options_modal"),d=(b.find(".modal-body"),b.data("type"));a[d].set(),b.modal("hide")}),$(document).on("click",".element > input, .element > textarea, .element > label",function(a){a.preventDefault()}),$(".component > input, .component > textarea, .component > label, .checkbox, .radio").on("click",function(a){a.preventDefault(),a.stopPropagation()}),$("#content").droppable({accept:".component",hoverClass:"content-hover",drop:function(b,c){a.addComponent(c.draggable)}}).sortable({placeholder:"element-placeholder",start:function(a,b){b.item.popover("hide")}}).disableSelection(),$("#content_form_name").on("click",function(){a.loadOptions.call(this,"title")}),source=CodeMirror.fromTextArea(document.getElementById("source"),{lineNumbers:!0,tabMode:"indent",mode:{name:"htmlmixed"}}),$("a[href=#source-tab]").on("click",function(){setTimeout(function(){a.updateSource(),source.refresh()},1)})});